scalar Date
scalar JSON

type Query {
  user: User
  scope: String!
  stripe: Stripe
  agents: [Agent]
  agent(agentId: ID!, filters: TaskFilters): Agent
  places: [Place]
  place(placeId: ID!, filters: TaskFilters): Place
  organizationTasks(filters: TaskFilters): [Task]
  organizationTask(taskId: ID!): Task
  agentTasks(filters: TaskFilters): [Task]
  agentTask(taskId: ID!): Task
  stop(stopId: ID!): Stop
}

type Mutation {
  loginPhone(phone: String!): Boolean!
  loginConfirm(code: Int!): String!
  createUser(email: String!, password: String!, organization: String!): String!
  createSession(email: String!, password: String!): String!
  createAgent(name: String!, phone: String!): Agent!
  createLocation(position: LocationPosition!, createdAt: Date): Location!
  createPlace(
    name: String!
    phone: String
    email: String
    description: String!
    lat: Float!
    lng: Float!
  ): Place!
  createTask(agentId: ID!, startAt: Date!, placeIds: [ID]!, route: JSON!): Task!
  createArrival(stopId: ID!, note: String): Stop
  detachPaymentMethod(paymentMethodId: ID!): Boolean
}

type User {
  id: ID!
  email: String
  phone: String
  agents: [Agent]
  places: [Place]
  organization: Organization
}

type Organization {
  id: ID!
  name: String!
}

type Stripe {
  setupIntent: JSON
  paymentMethods: JSON
}

type Agent {
  id: ID!
  name: String!
  location: Location
  tasks: [Task]
}

type Location {
  id: ID!
  position: JSON!
  createdAt: Date!
}

input LocationPosition {
  latitude: Float!
  longitude: Float!
  accuracy: Float
  altitude: Float
  altitudeAccuracy: Float
  heading: Float
  simulated: Boolean
  speed: Float
  timestamp: Float
}

type Place {
  id: ID!
  name: String!
  phone: String
  email: String
  description: String!
  lat: Float!
  lng: Float!
  tasks(filters: TaskFilters): [Task]
}

type Stop {
  id: ID!
  place: Place!
  order: Int!
  note: String
  arrivedAt: Date
}

type Task {
  id: ID!
  agent: Agent!
  startAt: Date!
  stops: [Stop]!
  route: JSON!
}

input TaskFilters {
  start: Date
  end: Date
  status: TaskStatus
}

enum TaskStatus {
  INCOMPLETE
  COMPLETE
}
